<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.554">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>htahack2024 -</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">htahack2024</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="./index.html" aria-current="page"> 
<span class="menu-text">Home</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
    <div class="dropdown">
      <a href="" title="" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label=""><i class="bi bi-github"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/n8thangreen/htahack2024">
            Source Code
            </a>
          </li>
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/n8thangreen/htahack2024/issues">
            Report a Bug
            </a>
          </li>
      </ul>
    </div>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">




<style>
  .registration-button {
    display: inline-block;
    background-color: #4CAF50;
    color: white;
    padding: 10px 20px;
    text-align: center;
    text-decoration: none;
    font-size: 16px;
    border-radius: 5px;
    border: none;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }

  .registration-button:hover {
    background-color: #45a049;
  }
</style>
<center>
<a><img src="images/Queens-University-Belfast-Website-Header-Mobile-2023.jpg" width="800px" height="300px"></a>
</center>
<center>
<h1>
R in HTA Hackathon<br>
5th - 6th August 2024
</h1>
<center>
<a><img src="images/QUB-logo.png" width="200px" height="100px"></a> <a><img src="images/ICMS-logo.png" width="200px" height="100px"></a>
</center>
<p><br></p>
<p><a href="https://forms.gle/1GejbDakJFnWejCz9" target="_blank" class="registration-button">Register Now</a></p>
</center>
<center>
<h2 class="anchored">
A 2 day event at Queen’s University Belfast, Ireland for health economists, statisticians and R users
</h2>
</center>
<section id="overview" class="level3">
<h3 class="anchored" data-anchor-id="overview">Overview</h3>
<p>Are you interested in using the power of <span style="color: blue;">R programming</span> to tackle problems in health economics?</p>
<p>Do you want to join up with a <span style="color: blue;">community of like-minded people</span>?</p>
<p>This will involve <span style="color: blue;">small group project work</span> developing novel health economics tools, as well as training in related data science skills.</p>
<p>See the <a href="#agenda">agenda</a> for more details.</p>
<p>This event is <span style="color: blue;">open to all participants</span>, with different levels and experience in using R.</p>
<p><span style="color: blue;">Financial support</span> for travel and over-night accommodation is available to those that qualify.</p>
</section>
<section id="challenge-themes" class="level3">
<h3 class="anchored" data-anchor-id="challenge-themes">Challenge themes</h3>
<p>To help with development and selection, the tackled problems will fit within five broad challenge areas. These are:</p>
<ul>
<li>Reproducibility in HTA</li>
<li>Reading, cleaning, and storing HTA data</li>
<li>Reporting HTA results</li>
<li>HTA model robustness</li>
<li>HTA functionality and workflows</li>
</ul>
<p>Example projects within these themes could be, but are not limited to:</p>
<ul>
<li>Extending existing packages e.g.&nbsp;extended multistate model packages to explicitly incorporate cost-effectiveness analysis.</li>
<li>Better handling of sensitivity analysis data</li>
<li>Improving visualisation of economic evaluation data, statistics and uncertainties</li>
<li>Improving ease of use e.g.&nbsp;simply by adding an extra level of abstraction to existing R package so that new higher-level functions can be exploited by practitioners and policymakers</li>
<li>AI for model creating, checking and reporting</li>
</ul>
</section>
<section id="outputs" class="level3">
<h3 class="anchored" data-anchor-id="outputs">Outputs</h3>
<p>Including the following</p>
<ul>
<li>Kick-start early-stage collaboration among academics, government and industry.</li>
<li>Set-up new networks to promote the exchange of ideas, information sharing, best practice, and other research goals.</li>
<li>Strengthen existing and establish new communities of interest.</li>
<li>Propose future collaboration and projects.</li>
<li>Establish a hackathon format for future events around other economic evaluations themes.</li>
<li>Develop a set of R packages that can be used by the wider health economics community.</li>
<li>Develop a set of training materials that can be used by the wider health economics community.</li>
<li>Fun and enjoyment!</li>
</ul>
<p>To ensure a safe, enjoyable, and friendly experience for everyone who participates, we have a strict <a href="./code-of-conduct.html">code of conduct</a>.</p>
<p>More details can be found in <a href="#faq">FAQ</a>.</p>
</section>
<section id="agenda" class="level1">
<h1>Workshop Agenda</h1>
<p>(Provisional and subject to change)</p>
<table class="table">
<thead>
<tr class="header">
<th>Time</th>
<th>Session</th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>DAY 1</strong></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td><em>Monday 5th August</em></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>9:00 - 9:30</td>
<td>Registration &amp; welcome breakfast</td>
<td></td>
</tr>
<tr class="even">
<td>9:30 - 10:00</td>
<td>Introductions, setup, and aims</td>
<td></td>
</tr>
<tr class="odd">
<td>10:00 - 10:30</td>
<td>Problem presentations and team forming</td>
<td></td>
</tr>
<tr class="even">
<td>10:30 - 11:00</td>
<td><em>Coffee</em></td>
<td></td>
</tr>
<tr class="odd">
<td>11:00 - 12:30</td>
<td>Coding</td>
<td></td>
</tr>
<tr class="even">
<td>12:30 - 13:30</td>
<td><em>Networking Lunch</em></td>
<td></td>
</tr>
<tr class="odd">
<td>13:30 - 15:00</td>
<td>Coding/skills sessions</td>
<td></td>
</tr>
<tr class="even">
<td>15:00 - 15:30</td>
<td><em>Coffee</em></td>
<td></td>
</tr>
<tr class="odd">
<td>15:30 - 17:30</td>
<td>Coding/skills sessions</td>
<td></td>
</tr>
<tr class="even">
<td>17:30</td>
<td>Wrap-up</td>
<td></td>
</tr>
<tr class="odd">
<td>18:00</td>
<td>Evening meal/drinks <a href="https://www.villaitaliarestaurant.co.uk">Villa Italia</a></td>
<td></td>
</tr>
<tr class="even">
<td><strong>DAY 2</strong></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td><em>Tuesday 6th August</em></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>8:30 - 9:00</td>
<td>Optional skills session</td>
<td></td>
</tr>
<tr class="odd">
<td>9:00 - 9:30</td>
<td><em>Breakfast &amp; coffee</em></td>
<td></td>
</tr>
<tr class="even">
<td>9:30 - 10:30</td>
<td>Coding</td>
<td></td>
</tr>
<tr class="odd">
<td>10:30 - 11:00</td>
<td><em>Coffee</em></td>
<td></td>
</tr>
<tr class="even">
<td>11:00 - 12:30</td>
<td>Coding/skills sessions</td>
<td></td>
</tr>
<tr class="odd">
<td>12:30 - 13:30</td>
<td><em>Networking Lunch</em></td>
<td></td>
</tr>
<tr class="even">
<td>13:30 - 15:00</td>
<td>Coding/skills sessions</td>
<td></td>
</tr>
<tr class="odd">
<td>15:00 - 15:30</td>
<td>Group presentations</td>
<td></td>
</tr>
<tr class="even">
<td>15:30 - 16:00</td>
<td>Feedback, wrap-up and finish</td>
<td></td>
</tr>
</tbody>
</table>
</section>
<section id="faq" class="level1">
<h1>FAQ</h1>
<section id="what-is-a-hackathon" class="level3">
<h3 class="anchored" data-anchor-id="what-is-a-hackathon">What is a hackathon?</h3>
<p>A hackathon is an event where participants can learn, build and share their created computer code over the course of a few days in a relaxed and welcoming atmosphere. Participants don’t have to be an expert programmer. The event is designed to be inclusive and fun.</p>
</section>
<section id="why-people-should-take-part" class="level3">
<h3 class="anchored" data-anchor-id="why-people-should-take-part">Why people should take part?</h3>
<p>This event will be a unique opportunity to meet and form a community of like-minded people, hear from expert speakers and have the chance to develop your innovative ideas to solve HTA problems.</p>
</section>
<section id="what-are-the-attendance-costs" class="level3">
<h3 class="anchored" data-anchor-id="what-are-the-attendance-costs">What are the attendance costs?</h3>
<p>The event will be free to attend. We will provide financial support with travel and accommodation for those that qualify. Please indicate in the application form. However, there is the expectation that those who can cover their own travel costs from their own funds will do so.</p>
</section>
<section id="where-to-stay" class="level3">
<h3 class="anchored" data-anchor-id="where-to-stay">Where to stay?</h3>
<p>You are responsible for booking your own travel and accommodation but we will provide more information when your place is confirmed. <!-- (Malone Lodge Hotel](https://www.themalonehotel.com/) which is close to the University. --></p>
</section>
<section id="who-can-apply" class="level3">
<h3 class="anchored" data-anchor-id="who-can-apply">Who can apply?</h3>
<p>The workshop is open to all. Attendees must be over 18. Because of the nature of the event attendees must already have some grounding in using R. The most important thing is enthusiasm and a willingness to learn. We are interested in people who have domain expertise but are not expert programmers, and the other way around. There will be some up-skilling talks and demonstrations during the workshop in specialist areas.</p>
</section>
<section id="how-many-participants" class="level3">
<h3 class="anchored" data-anchor-id="how-many-participants">How many participants?</h3>
<p>The number of spaces will be limited to 30 participants.</p>
</section>
<section id="is-there-training" class="level3">
<h3 class="anchored" data-anchor-id="is-there-training">Is there training?</h3>
<p>Skills sessions will provide additional capacity building in R and software engineer from experiences experts. The RSE are employed to write software engineer quality code in a research environment and so will offer guidance and advice with knowledge from both perspectives. Sessions will cover e.g.&nbsp;unit testing, literate programming, package development, git and GitHub, but there will be some flexibility catered for, depending on the demands of the group.</p>
</section>
<section id="is-there-food-and-drink" class="level3">
<h3 class="anchored" data-anchor-id="is-there-food-and-drink">Is there food and drink?</h3>
<p>A buffet-style breakfast and lunch will be provided on both days, ensuring to cater for dietary requirements. An evening meal and networking event will be arranged for the end of day one at <a href="https://www.villaitaliarestaurant.co.uk">Villa Italia</a>. Coffee and refreshments will be made available throughout the event. This is an important component for this type of event.</p>
</section>
<section id="why-queens-university-belfast" class="level3">
<h3 class="anchored" data-anchor-id="why-queens-university-belfast">Why Queens University Belfast?</h3>
<p>QUB is a global research institute with state-of-the-art computing facilities. In particular, a bespoke computer room within the School of Electronics, Engineering and Computer Science has been fitted for teaching Data Analytics. These computers have all the latest software and packages, including R, and high processing power. This space has been used before for external events and is a perfect space to hold this event.</p>
</section>
<section id="how-are-the-teams-formed-and-problem-selection" class="level3">
<h3 class="anchored" data-anchor-id="how-are-the-teams-formed-and-problem-selection">How are the teams formed and problem selection?</h3>
<p>Before the start of the hackathon there will be an open conversation for idea generation, about what particular problems the participants are most interested in tackling. Then at the event itself, a handful of project will be pitched on the opening morning and participants are free to pick and choose which they would like to work on.</p>
</section>
<section id="who-are-the-instructors-support-experts-and-presenters" class="level3">
<h3 class="anchored" data-anchor-id="who-are-the-instructors-support-experts-and-presenters">Who are the instructors, support experts and presenters?</h3>
<p>There will be a participant project lead for each group of 3-5 people. There will also be R experts on-hand “floating” around the groups.</p>
</section>
</section>
<section id="location" class="level1">
<h1>Location</h1>
<p>Both days will be held at <a href="https://www.qub.ac.uk/">Queen’s University Belfast, Ireland</a>.</p>
<iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d9248.446155104257!2d-5.950528792187561!3d54.5844087!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x486108ea57227da7%3A0x3cecfa2a15d642e1!2sQueen's%20University%20Belfast!5e0!3m2!1sen!2suk!4v1714749567792!5m2!1sen!2suk" width="600" height="450" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade">
</iframe>
</section>
<section id="registration" class="level1">
<h1>Registration</h1>
<p><a href="https://forms.gle/1GejbDakJFnWejCz9" target="_blank" class="registration-button">Register Now</a></p>
</section>
<section id="contact-us" class="level1">
<h1>Contact Us</h1>
<p>To learn more, don’t hesitate to get in touch</p>
<p><strong>Email:</strong> <a href="mailto:contact@example.com">n(dot)green@ucl(dot)ac(dot)uk</a></p>
<p><br></p>
<p>This event was kindly funded by the <a href="https://www.icms.org.uk/funding-opportunities/strategic-workshops">International Centre for Mathematical Sciences (ICMS)</a></p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>